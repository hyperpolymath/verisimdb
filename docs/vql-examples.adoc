// SPDX-License-Identifier: PMPL-1.0-or-later

= VeriSim Query Language (VQL) Examples
:toc: left
:toclevels: 3
:sectnums:

== Overview

This document provides **63 comprehensive examples** of VQL queries and mutations for both **dependent-type** (formally verified) and **slipstream** (fast, unverified) paths, including backwards compatibility (VERSION), drift handling (DRIFT REPAIR), SQL-compatible extensions (ORDER BY, GROUP BY, HAVING, aggregates, column projections), multi-proof composition, cross-modal correlation conditions, and write path mutations (INSERT/UPDATE/DELETE).

== Basic Queries

=== Example 1: Simple Hexad Retrieval

**Slipstream** (no proof):
[source,vql]
----
SELECT *
FROM HEXAD 550e8400-e29b-41d4-a716-446655440000
----

**Dependent-Type** (with proof):
[source,vql]
----
SELECT *
FROM HEXAD 550e8400-e29b-41d4-a716-446655440000
PROOF EXISTENCE(ExistenceContract)
----

=== Example 2: Modality-Specific Selection

**Graph Only:**
[source,vql]
----
SELECT GRAPH
FROM HEXAD 550e8400-e29b-41d4-a716-446655440000
WHERE (h)-[:CITES]->(target)
----

**Vector Only:**
[source,vql]
----
SELECT VECTOR
FROM HEXAD 550e8400-e29b-41d4-a716-446655440000
WHERE h.embedding SIMILAR TO [0.1, 0.2, 0.3, 0.4]
----

**Multiple Modalities:**
[source,vql]
----
SELECT GRAPH, VECTOR, SEMANTIC
FROM HEXAD 550e8400-e29b-41d4-a716-446655440000
PROOF INTEGRITY(DataIntegrityContract)
----

== Graph Queries (Oxigraph)

=== Example 3: Citation Chain Traversal

**Slipstream:**
[source,vql]
----
SELECT GRAPH
FROM FEDERATION /universities/*
WHERE (h)-[:CITES*1..5]->(paper)
  AND paper.title LIKE "%climate change%"
LIMIT 100
----

**Dependent-Type:**
[source,vql]
----
SELECT GRAPH
FROM FEDERATION /universities/* WITH DRIFT STRICT
WHERE (h)-[:CITES*1..5]->(paper)
  AND paper.title LIKE "%climate change%"
  AND SATISFIES CitationContract
PROOF CITATION(CitationChainContract)
LIMIT 100
----

=== Example 4: Bidirectional Graph Traversal

[source,vql]
----
SELECT GRAPH
FROM HEXAD abc12345-0000-0000-0000-000000000000
WHERE (h)-[:CO_AUTHOR]-(colleague)
  AND (colleague)-[:AFFILIATED_WITH]->(institution)
  AND institution.country == "USA"
----

=== Example 5: Property Graph Query

[source,vql]
----
SELECT GRAPH
FROM STORE oxigraph-node-1
WHERE (author)-[:WROTE]->(paper)
  AND paper.citations > 100
  AND paper.year >= 2020
PROOF ACCESS(ReadAccessContract)
----

== Vector Queries (Milvus)

=== Example 6: Similarity Search (ANN)

**Slipstream:**
[source,vql]
----
SELECT VECTOR
FROM FEDERATION /embeddings/*
WHERE h.embedding SIMILAR TO [0.12, 0.45, 0.78, ...] WITHIN 0.8
LIMIT 10
----

**Dependent-Type:**
[source,vql]
----
SELECT VECTOR
FROM FEDERATION /embeddings/* WITH DRIFT REPAIR
WHERE h.embedding SIMILAR TO [0.12, 0.45, 0.78, ...]
  WITHIN 0.9
  USING COSINE
  AND SATISFIES EmbeddingQualityContract(min_dimension=768)
PROOF INTEGRITY(VectorIntegrityContract)
LIMIT 20
----

=== Example 7: K-Nearest Neighbors

[source,vql]
----
SELECT VECTOR
FROM HEXAD query-embedding-uuid
WHERE h.embedding NEAREST 15 USING DOT_PRODUCT
  AND h.metadata.domain == "neuroscience"
----

=== Example 8: Filtered Vector Search

[source,vql]
----
SELECT VECTOR, DOCUMENT
FROM FEDERATION /research-papers/*
WHERE h.embedding SIMILAR TO [0.5, 0.3, 0.2, ...]
  AND FULLTEXT CONTAINS "deep learning"
  AND h.year >= 2023
LIMIT 50
----

== Semantic Queries (verisim-semantic + proven)

=== Example 9: ZKP-Verified Access

**Dependent-Type:**
[source,vql]
----
SELECT SEMANTIC, DOCUMENT
FROM HEXAD confidential-data-uuid
WHERE SATISFIES AccessControlContract(role=researcher, institution=MIT)
  AND HAS PROOF ACCESS
PROOF ACCESS(InstitutionalAccessContract) WITH verifier=ethics-board
----

=== Example 10: Provenance Verification

**Dependent-Type:**
[source,vql]
----
SELECT SEMANTIC, TEMPORAL
FROM FEDERATION /clinical-trials/*
WHERE SATISFIES ProvenanceContract
  AND VERIFIED BY fda-validator
  AND AS OF 2025-01-01T00:00:00Z
PROOF PROVENANCE(ClinicalTrialContract)
----

=== Example 11: Multi-Contract Validation

**Dependent-Type:**
[source,vql]
----
SELECT *
FROM HEXAD research-dataset-uuid
WHERE SATISFIES GDPRContract(anonymized=true)
  AND SATISFIES FAIRContract(findable=true, accessible=true)
  AND SATISFIES LicenseContract(license=CC-BY-4.0)
PROOF CUSTOM(ComplianceContract) WITH auditor=legal-team
----

== Document Queries (Tantivy)

=== Example 12: Full-Text Search

**Slipstream:**
[source,vql]
----
SELECT DOCUMENT
FROM FEDERATION /archives/*
WHERE FULLTEXT CONTAINS "quantum computing"
LIMIT 1000
----

**Dependent-Type:**
[source,vql]
----
SELECT DOCUMENT
FROM FEDERATION /archives/* WITH DRIFT TOLERATE
WHERE FULLTEXT CONTAINS "quantum computing"
  AND SATISFIES CitationContract
PROOF EXISTENCE(ArchiveContract)
LIMIT 100
----

=== Example 13: Regex Pattern Matching

[source,vql]
----
SELECT DOCUMENT
FROM STORE tantivy-node-3
WHERE FULLTEXT MATCHES /\b(AI|ML|DL)\b.*ethics/
  AND FIELD author == "Jane Doe"
  AND FIELD year >= 2020
----

=== Example 14: Structured Field Queries

[source,vql]
----
SELECT DOCUMENT, SEMANTIC
FROM FEDERATION /journals/*
WHERE FIELD doi LIKE "10.1234/%"
  AND FIELD impact_factor >= 5.0
  AND SATISFIES PeerReviewContract
----

== Tensor Queries (Burn/ndarray)

=== Example 15: Tensor Shape Filtering

[source,vql]
----
SELECT TENSOR
FROM HEXAD tensor-data-uuid
WHERE tensor.data SHAPE == [256, 256, 3]
  AND tensor.dtype == "float32"
----

=== Example 16: Tensor Operations

[source,vql]
----
SELECT TENSOR
FROM STORE burn-node-2
WHERE tensor.data RANK == 3
  AND tensor.statistics.mean > 0.5
  AND tensor.statistics.std < 0.2
----

== Temporal Queries (verisim-temporal)

=== Example 17: Point-in-Time Query

**Dependent-Type:**
[source,vql]
----
SELECT TEMPORAL, DOCUMENT
FROM HEXAD legal-document-uuid
WHERE AS OF 2024-06-15T10:30:00Z
PROOF PROVENANCE(TemporalContract)
----

=== Example 18: Version Range Query

[source,vql]
----
SELECT TEMPORAL, GRAPH
FROM FEDERATION /contracts/*
WHERE BETWEEN 2024-01-01T00:00:00Z AND 2024-12-31T23:59:59Z
  AND MODIFIED BY legal-team
----

=== Example 19: Specific Version

**Dependent-Type:**
[source,vql]
----
SELECT *
FROM HEXAD retracted-paper-uuid
WHERE VERSION v3-final
  AND SATISFIES RetractionContract(reason=error-in-methodology)
PROOF PROVENANCE(RetractionContract)
----

== Multi-Modal Queries

=== Example 20: Neurosymbolic AI Query

**Dependent-Type:**
[source,vql]
----
-- Find papers similar to embedding that cite a specific work
SELECT GRAPH, VECTOR, DOCUMENT
FROM FEDERATION /research-db/* WITH DRIFT REPAIR
WHERE h.embedding SIMILAR TO [0.1, 0.2, ...] WITHIN 0.85
  AND (h)-[:CITES]->(target_paper)
  AND target_paper.uuid == "123e4567-e89b-12d3-a456-426614174000"
  AND FULLTEXT CONTAINS "neural-symbolic integration"
  AND SATISFIES CitationContract
PROOF CITATION(NeurosymbolicContract)
LIMIT 50
----

=== Example 21: Cross-Modal Consistency Check

**Dependent-Type:**
[source,vql]
----
-- Verify document content matches vector embedding
SELECT DOCUMENT, VECTOR, SEMANTIC
FROM HEXAD suspicious-entry-uuid
WHERE SATISFIES ConsistencyContract(
    vector_matches_text=true,
    semantic_alignment=high
  )
PROOF INTEGRITY(CrossModalContract)
----

=== Example 22: Federated Provenance Audit

**Dependent-Type:**
[source,vql]
----
-- Audit trail across multiple institutions
SELECT TEMPORAL, SEMANTIC, GRAPH
FROM FEDERATION /universities/* WITH DRIFT STRICT
WHERE AS OF 2025-01-01T00:00:00Z
  AND (h)-[:DERIVED_FROM]->(source)
  AND VERIFIED BY institutional-review-board
  AND SATISFIES ProvenanceContract
  AND SATISFIES EthicsContract(irb_approved=true)
PROOF PROVENANCE(MultiInstitutionalContract) WITH auditor=nsf
----

== Drift Handling Queries

=== Example 23: Strict Drift (Fail on Inconsistency)

**Dependent-Type:**
[source,vql]
----
SELECT *
FROM FEDERATION /legal-records/* WITH DRIFT STRICT
WHERE AS OF 2024-01-01T00:00:00Z
PROOF INTEGRITY(LegalContract)
----

**Behavior:** Query fails if any node has drifted from the specified timestamp.

=== Example 24: Auto-Repair Drift

**Dependent-Type:**
[source,vql]
----
SELECT GRAPH, DOCUMENT
FROM FEDERATION /collaborative-wiki/* WITH DRIFT REPAIR
WHERE (h)-[:LINKS_TO]->(target)
  AND FULLTEXT CONTAINS "VeriSimDB"
PROOF EXISTENCE(WikiContract)
----

**Behavior:** Elixir `DriftMonitor` detects and repairs inconsistencies before returning results.

=== Example 25: Tolerate Drift (Return Inconsistent Data)

**Slipstream:**
[source,vql]
----
SELECT *
FROM FEDERATION /mirrors/* WITH DRIFT TOLERATE
WHERE FULLTEXT CONTAINS "archived content"
LIMIT 1000
----

**Behavior:** Returns data even if nodes are inconsistent. Useful for exploratory queries.

=== Example 26: Latest Version (Ignore Drift)

**Slipstream:**
[source,vql]
----
SELECT DOCUMENT
FROM FEDERATION /news-feeds/* WITH DRIFT LATEST
WHERE FULLTEXT CONTAINS "breaking news"
LIMIT 10
----

**Behavior:** Uses the most recent version from each node, ignoring temporal consistency.

== Performance Optimization Examples

=== Example 27: Pagination for Large Result Sets

[source,vql]
----
SELECT DOCUMENT
FROM FEDERATION /archives/*
WHERE FULLTEXT CONTAINS "machine learning"
LIMIT 100
OFFSET 500
----

=== Example 28: Store-Specific Query (Bypass Federation)

[source,vql]
----
-- Query specific store for lowest latency
SELECT VECTOR
FROM STORE milvus-us-east-1
WHERE h.embedding NEAREST 20 USING COSINE
----

=== Example 29: Minimal Modality Selection

[source,vql]
----
-- Only request needed modalities to reduce data transfer
SELECT GRAPH(nodes, edges)
FROM HEXAD abc-123
WHERE (h)-[:CITES]->(target)
----

== Error Handling Examples

=== Example 30: Proof Verification Failure

**Query:**
[source,vql]
----
SELECT SEMANTIC
FROM HEXAD protected-data-uuid
WHERE SATISFIES AccessControlContract(role=guest)
PROOF ACCESS(GuestAccessContract)
----

**Expected Error:**
[source,json]
----
{
  "error": "ProofVerificationFailed",
  "message": "ZKP verification failed for AccessControlContract",
  "details": {
    "contract": "GuestAccessContract",
    "reason": "Insufficient permissions (requires role=researcher)"
  }
}
----

=== Example 31: Drift Detection Failure

**Query:**
[source,vql]
----
SELECT *
FROM FEDERATION /distributed-ledger/* WITH DRIFT STRICT
WHERE AS OF 2024-01-01T00:00:00Z
----

**Expected Error:**
[source,json]
----
{
  "error": "DriftDetected",
  "message": "Inconsistency detected across federated nodes",
  "details": {
    "divergent_nodes": ["node-2", "node-5"],
    "drift_type": "TemporalInconsistency",
    "suggestion": "Use DRIFT REPAIR or DRIFT TOLERATE"
  }
}
----

=== Example 32: Malformed Query

**Query:**
[source,vql]
----
SELECT GRAPH
FROM HEXAD not-a-valid-uuid
WHERE (h)-[:INVALID_SYNTAX
----

**Expected Error:**
[source,json]
----
{
  "error": "ParseError",
  "message": "Failed to parse VQL query",
  "details": {
    "line": 3,
    "column": 27,
    "expected": "]->"
  }
}
----

== Advanced Use Cases

=== Example 33: Recursive Citation Network

**Dependent-Type:**
[source,vql]
----
-- Find all papers in transitive citation closure
SELECT GRAPH
FROM FEDERATION /research-db/* WITH DRIFT REPAIR
WHERE (seed_paper)-[:CITES*1..10]->(h)
  AND seed_paper.uuid == "root-paper-uuid"
  AND h.year >= 2020
  AND SATISFIES CitationContract
PROOF CITATION(TransitiveClosureContract)
LIMIT 1000
----

=== Example 34: Multi-Institutional Data Aggregation

**Dependent-Type:**
[source,vql]
----
-- Aggregate COVID-19 data from multiple hospitals
SELECT SEMANTIC, TEMPORAL, DOCUMENT
FROM FEDERATION /hospitals/* WITH DRIFT STRICT
WHERE AS OF 2024-12-31T23:59:59Z
  AND SATISFIES HIPAAContract(anonymized=true, aggregated=true)
  AND SATISFIES IRBContract(protocol=COVID-2024-001)
  AND FIELD diagnosis LIKE "%COVID%"
PROOF PROVENANCE(MultiInstitutionalHealthContract)
  WITH auditor=cdc
----

=== Example 35: Real-Time Embeddings Query

**Slipstream:**
[source,vql]
----
-- Fast similarity search for recommendation system
SELECT VECTOR
FROM STORE milvus-cache
WHERE h.embedding SIMILAR TO [0.5, 0.3, ...] WITHIN 0.75
  AND h.metadata.category == "electronics"
  AND h.metadata.in_stock == true
LIMIT 20
----

== Comparison: Dependent-Type vs Slipstream

=== Same Query, Two Paths

**Slipstream (Fast, Unverified):**
[source,vql]
----
SELECT GRAPH, VECTOR
FROM FEDERATION /papers/*
WHERE (h)-[:CITES]->(target)
  AND h.embedding SIMILAR TO [0.1, 0.2, 0.3]
LIMIT 100
----

**Dependent-Type (Slow, Verified):**
[source,vql]
----
SELECT GRAPH, VECTOR
FROM FEDERATION /papers/* WITH DRIFT STRICT
WHERE (h)-[:CITES]->(target)
  AND h.embedding SIMILAR TO [0.1, 0.2, 0.3]
  AND SATISFIES CitationContract
  AND SATISFIES EmbeddingQualityContract(dimension=768)
PROOF CITATION(VerifiedCitationContract)
LIMIT 100
----

**Performance Comparison:**

|===
| Metric | Slipstream | Dependent-Type

| Latency
| ~50ms
| ~300ms (includes ZKP generation)

| Guarantees
| None
| Formal verification via ZKP

| Use Case
| Exploratory analysis
| Audit-ready queries

| Audit Trail
| Logged to verisim-temporal
| Logged with proof to verisim-temporal
|===

== Summary

VQL provides two execution paths:

1. **Dependent-Type Path** (`PROOF` clause present):
   - Formal verification via `proven-library`
   - Drift detection/repair via Elixir `DriftMonitor`
   - ZKP generation for audit trails
   - Slower but audit-ready

2. **Slipstream Path** (no `PROOF` clause):
   - Fast, unverified execution
   - No proof generation overhead
   - Suitable for exploratory queries
   - Still logged for audit (but without proofs)

**Recommendation:** Use dependent-type path for:
- Compliance queries (GDPR, HIPAA, FAIR)
- Multi-institutional data sharing
- Citation verification
- Provenance audits

Use slipstream path for:
- Real-time recommendations
- Exploratory data analysis
- Performance-critical applications
- Internal queries with trusted data

== Backwards Compatibility Queries

=== Example 36: Version Pinning

**Query with explicit VQL version:**
[source,vql]
----
VERSION 1.0;

SELECT GRAPH, DOCUMENT
FROM verisim:semantic
WHERE hexad.types INCLUDES "http://schema.org/Person"
LIMIT 10;
----

**Query using deprecated syntax (with warning):**
[source,vql]
----
VERSION 0.9;  -- Deprecated syntax accepted

FROM verisim:semantic
SELECT GRAPH, DOCUMENT
WHERE hexad.types INCLUDES "http://schema.org/Person"
LIMIT 10;
----

=== Example 37: Federation Version Negotiation

**Query with version compatibility check:**
[source,vql]
----
VERSION 1.0;

SELECT *
FROM FEDERATION /universities/*
WITH DRIFT LATEST  -- Use latest schema version
WHERE hexad.types INCLUDES "Paper"
LIMIT 100;
----

== Drift Handling Queries

=== Example 38: Drift Detection

**Detect cross-modal drift:**
[source,vql]
----
SELECT DRIFT
FROM verisim:all_modalities
WHERE hexad.id = @hexad_id;

-- Returns: {
--   "drifts": [
--     {"type": "title_mismatch", "graph": "ML Paper", "document": "Machine Learning Paper"}
--   ]
-- }
----

=== Example 39: Drift Repair - Latest Wins

**Repair using most recent version:**
[source,vql]
----
DRIFT REPAIR
FROM verisim:graph
WHERE hexad.id = @id
USING STRATEGY latest_wins;
----

=== Example 40: Drift Repair - Quorum

**Repair using majority voting:**
[source,vql]
----
DRIFT REPAIR
FROM verisim:federation /universities/*
WHERE hexad.id = @id
USING STRATEGY quorum;
----

=== Example 41: Drift-Aware Query

**Query with drift tolerance:**
[source,vql]
----
SELECT GRAPH, DOCUMENT
FROM FEDERATION /universities/*
WITH DRIFT TOLERATE  -- Return data despite drift
WHERE hexad.types INCLUDES "Paper"
LIMIT 100;
----

=== Example 42: Byzantine-Resistant Query

**Query with drift repair:**
[source,vql]
----
SELECT GRAPH, DOCUMENT
FROM FEDERATION /universities/*
WITH DRIFT REPAIR  -- Auto-repair detected drift
WHERE hexad.types INCLUDES "Paper"
LIMIT 100;
----

== SQL-Compatible Extensions

=== Example 43: Column Selection within Modality

**Select specific fields from a modality (slipstream):**
[source,vql]
----
SELECT DOCUMENT.name, DOCUMENT.severity
FROM HEXAD 550e8400-e29b-41d4-a716-446655440000
----

**Mixed modalities and column projections:**
[source,vql]
----
SELECT GRAPH, DOCUMENT.name, DOCUMENT.severity
FROM FEDERATION /universities/*
LIMIT 50
----

=== Example 44: ORDER BY — Sort Results

**Sort by severity descending:**
[source,vql]
----
SELECT DOCUMENT
FROM STORE archive-1
WHERE FULLTEXT CONTAINS "security"
ORDER BY DOCUMENT.severity DESC
LIMIT 50
----

**Multi-field sort:**
[source,vql]
----
SELECT DOCUMENT.name, DOCUMENT.severity
FROM FEDERATION /archives/*
ORDER BY DOCUMENT.severity DESC, DOCUMENT.name ASC
LIMIT 100
----

=== Example 45: COUNT(*), SUM, AVG — Aggregate Functions

**Count all matching hexads:**
[source,vql]
----
SELECT COUNT(*)
FROM FEDERATION /archives/*
WHERE FULLTEXT CONTAINS "vulnerability"
----

**Aggregate with field reference:**
[source,vql]
----
SELECT AVG(DOCUMENT.severity), MIN(DOCUMENT.severity), MAX(DOCUMENT.severity)
FROM FEDERATION /scans/*
----

**Sum and count together:**
[source,vql]
----
SELECT COUNT(*), SUM(DOCUMENT.severity)
FROM STORE tantivy-node-1
WHERE FIELD severity > 3
----

=== Example 46: GROUP BY / HAVING — Grouping with Filters

**Group results by field:**
[source,vql]
----
SELECT DOCUMENT.name, COUNT(*), AVG(DOCUMENT.severity)
FROM FEDERATION /universities/*
GROUP BY DOCUMENT.name
LIMIT 100
----

**GROUP BY with HAVING filter:**
[source,vql]
----
SELECT DOCUMENT.name, COUNT(*)
FROM FEDERATION /archives/*
GROUP BY DOCUMENT.name
HAVING FIELD count > 3
ORDER BY DOCUMENT.name ASC
LIMIT 50
----

=== Example 47: Full SQL-Compatible Query

**Combining all SQL-compatible features with VQL's model:**
[source,vql]
----
SELECT DOCUMENT.name, DOCUMENT.severity, COUNT(*), SUM(DOCUMENT.severity), AVG(DOCUMENT.severity)
FROM FEDERATION /universities/* WITH DRIFT REPAIR
WHERE FIELD severity > 3
GROUP BY DOCUMENT.name, DOCUMENT.severity
HAVING FIELD total > 10
ORDER BY DOCUMENT.severity DESC, DOCUMENT.name ASC
LIMIT 100
OFFSET 20
----

=== Example 48: SQL-Compatible with Dependent-Type Verification

**Combining aggregates with formal verification (VQL-dt path):**
[source,vql]
----
SELECT DOCUMENT.name, COUNT(*)
FROM FEDERATION /universities/* WITH DRIFT STRICT
GROUP BY DOCUMENT.name
PROOF INTEGRITY(DataIntegrityContract)
ORDER BY DOCUMENT.name ASC
LIMIT 50
----

NOTE: In the dependent-type path, aggregation results are also covered by the proof
guarantee — the ZKP witnesses include the aggregate computation, ensuring verified totals.

== Multi-Proof Composition (v2.0)

=== Example 49: Dual Proof — Existence and Integrity

**Dependent-Type:**
[source,vql]
----
SELECT *
FROM HEXAD 550e8400-e29b-41d4-a716-446655440000
PROOF EXISTENCE(ExistenceContract) AND INTEGRITY(DataIntegrityContract)
----

Both proofs must pass before results are returned. The ZKP witnesses for each proof
are generated independently and composed into a single proof bundle.

=== Example 50: Triple Proof — Access, Provenance, and Integrity

**Dependent-Type:**
[source,vql]
----
SELECT SEMANTIC, TEMPORAL, DOCUMENT
FROM FEDERATION /hospitals/* WITH DRIFT STRICT
WHERE SATISFIES HIPAAContract(anonymized=true)
PROOF ACCESS(InstitutionalAccessContract) AND PROVENANCE(ClinicalTrialContract) AND INTEGRITY(DataIntegrityContract)
LIMIT 100
----

Multi-proof composition validates that the user has access, the data lineage
is verifiable, and the data has not been tampered with — all three conditions
must hold simultaneously.

=== Example 51: Citation and Custom Proof

**Dependent-Type:**
[source,vql]
----
SELECT GRAPH, DOCUMENT
FROM FEDERATION /journals/* WITH DRIFT REPAIR
WHERE (h)-[:CITES]->(target)
  AND FULLTEXT CONTAINS "reproducibility crisis"
PROOF CITATION(CitationChainContract) AND CUSTOM(ReproducibilityContract)
LIMIT 50
----

== Cross-Modal Correlation Queries (v2.0)

=== Example 52: Cross-Modal Field Compare

**Compare fields across modalities:**
[source,vql]
----
SELECT DOCUMENT, GRAPH
FROM HEXAD 550e8400-e29b-41d4-a716-446655440000
WHERE DOCUMENT.severity > GRAPH.centrality
----

Evaluates after both modalities are fetched, comparing the document severity
field against the graph centrality field on the same hexad.

=== Example 53: Drift Between Modalities

**Detect embedding drift:**
[source,vql]
----
SELECT VECTOR, DOCUMENT
FROM FEDERATION /research-papers/*
WHERE DRIFT(VECTOR, DOCUMENT) > 0.3
LIMIT 50
----

Returns hexads where the vector embedding has drifted more than 0.3 from the
document representation. Useful for identifying stale embeddings.

=== Example 54: Consistency Check

**Verify cross-modal consistency:**
[source,vql]
----
SELECT VECTOR, SEMANTIC
FROM HEXAD suspicious-entry-uuid
WHERE CONSISTENT(VECTOR, SEMANTIC) USING COSINE
PROOF INTEGRITY(CrossModalContract)
----

Checks that the vector representation and semantic annotation are consistent
using cosine similarity as the metric.

=== Example 55: Modality Existence Check

**Filter by available modalities:**
[source,vql]
----
SELECT *
FROM FEDERATION /archives/*
WHERE VECTOR EXISTS
  AND TENSOR NOT EXISTS
LIMIT 100
----

Returns hexads that have vector embeddings but lack tensor data. Useful for
identifying hexads that need tensor representations generated.

=== Example 56: Combined Cross-Modal and Standard Conditions

**Mix cross-modal with single-modality conditions:**
[source,vql]
----
SELECT GRAPH, VECTOR, DOCUMENT
FROM FEDERATION /research-db/* WITH DRIFT REPAIR
WHERE FULLTEXT CONTAINS "neural networks"
  AND DRIFT(VECTOR, DOCUMENT) < 0.2
  AND VECTOR EXISTS
  AND GRAPH EXISTS
PROOF CITATION(NeuralNetworkContract) AND INTEGRITY(DataIntegrityContract)
LIMIT 50
----

Pushdown conditions (FULLTEXT CONTAINS) are sent to individual stores,
while cross-modal conditions (DRIFT, EXISTS) are evaluated post-fetch
on full hexad data.

== Write Path: INSERT / UPDATE / DELETE (v2.0)

=== Example 57: Insert a New Hexad

**Insert with document and vector data:**
[source,vql]
----
INSERT HEXAD WITH
  DOCUMENT(title = "New Research Paper", author = "Jane Doe", severity = 3),
  VECTOR([0.12, 0.45, 0.78, 0.23, 0.91])
----

Creates a new hexad with document and vector modalities populated.
The hexad ID is auto-generated and returned in the result.

=== Example 58: Insert with Graph Relationship

**Insert with cross-modal data:**
[source,vql]
----
INSERT HEXAD WITH
  DOCUMENT(title = "Follow-Up Study", year = 2026),
  VECTOR([0.5, 0.3, 0.2, 0.8]),
  GRAPH(CITES, 550e8400-e29b-41d4-a716-446655440000)
----

Creates a hexad with document content, embedding, and a graph edge
(CITES relationship to an existing hexad).

=== Example 59: Verified Insert with Proof

**Insert with integrity verification:**
[source,vql]
----
INSERT HEXAD WITH
  DOCUMENT(title = "Clinical Trial Result", status = "verified"),
  SEMANTIC(ClinicalTrialContract),
  TEMPORAL(2026-02-13T10:30:00Z)
PROOF INTEGRITY(WriteContract) AND PROVENANCE(AuditTrailContract)
----

The ZKP proofs are generated for the write operation itself, ensuring the
insert is verified and auditable.

=== Example 60: Update Hexad Fields

**Update specific fields:**
[source,vql]
----
UPDATE HEXAD 550e8400-e29b-41d4-a716-446655440000
SET DOCUMENT.title = "Corrected Title", DOCUMENT.severity = 5
----

Updates the document modality fields without affecting other modalities.
Drift detection will fire if the change creates cross-modal inconsistency.

=== Example 61: Verified Update with Proof

**Update with access proof:**
[source,vql]
----
UPDATE HEXAD 550e8400-e29b-41d4-a716-446655440000
SET DOCUMENT.status = "retracted", DOCUMENT.retraction_reason = "Data fabrication"
PROOF ACCESS(EditAccessContract) AND PROVENANCE(RetractionContract)
----

The update requires proof of edit access and creates a provenance record
of the retraction in the audit trail.

=== Example 62: Delete a Hexad

**Simple deletion:**
[source,vql]
----
DELETE HEXAD 550e8400-e29b-41d4-a716-446655440000
----

Removes the hexad and all its modality data. This operation is logged
in verisim-temporal for auditability.

=== Example 63: Verified Delete with Proof

**Delete with access and provenance proof:**
[source,vql]
----
DELETE HEXAD 550e8400-e29b-41d4-a716-446655440000
PROOF ACCESS(AdminAccessContract) AND PROVENANCE(DeletionAuditContract)
----

Requires proof of admin access before deletion. The provenance proof
ensures the deletion is recorded in the audit chain.

== References

- link:vql-grammar.ebnf[VQL Grammar (EBNF)]
- link:backwards-compatibility.adoc[Backwards Compatibility Strategy]
- link:drift-handling.adoc[Drift Handling Documentation]
- link:../WHITEPAPER.md[VeriSimDB White Paper]
- link:technical-specification-kraft-metadata-log.adoc[KRaft Metadata Log Specification]
- link:../design-decisions.adoc[Architecture Design Decisions]
